!function(){function t(t){return t.length?d3.keys(t[0]).sort():[]}function n(){d3.event.stopPropagation(),d3.event.preventDefault()}function e(t){return t.name}function r(t){return t[0].categories.reduce(function(t,n){return t+n.count},0)}function a(t,n){return function(e,r){var a=this.textContent=t(e,r),o=n(e,r);if(this.getComputedTextLength()<o)return a;this.textContent="…"+a;for(var i,u=0,c=a.length+1;c>u;){var s=u+c>>1;(i=this.getSubStringLength(0,s))<o?u=s+1:c=s}return u>1?a.substr(0,u-2)+"…":""}}function o(t,n,e,r){i(t);for(var a=n.length,o=e.length,u=0;a>u;u++){for(var c=n[u],s=+r(c,u),d=t,l=0;o>l;l++){var f=e[l],p=c[f],h=d.children;d.count+=s,d=h.hasOwnProperty(p)?h[p]:h[p]={children:l===o-1?null:{},count:0,parent:d,dimension:f,name:p}}d.count+=s}return t}function i(t){if(t.count=0,t.children)for(var n in t.children)i(t.children[n])}function u(t){return t}function c(t){return"translate(0,"+t.y+")"}function s(t){for(var n=t.count,e=[];t.parent;)t.name&&e.unshift(t.name),t=t.parent;return e.join(" > ")+"<br>"+f(n)+" ("+l(n/t.count)+")"}function d(t){return t.name+"<br>"+f(t.count)+" ("+l(t.count/t.dimension.count)+")"}d3.parsets=function(){function i(t){t.each(function(t,i){function s(){var t=d3.interpolateNumber(E,H);return function(n){E=t(n),_.attr("d",y)}}function d(){var a=J.selectAll("g.dimension"),i={};a.each(function(t){i[t.name]=t}),M.forEach(function(t){i.hasOwnProperty(t)||(i[t]={name:t,categories:[]}),Z.push(i[t])}),Z.sort(C),J.select(".ribbon").selectAll("path").each(function(t){for(var n=t.path.split("\x00"),e=G,r=n.length-1,a=0;r>a;a++){var o=n[a];e=e.children.hasOwnProperty(o)?e.children[o]:e.children[o]={children:{},count:0}}e.children[t.name]=t}),G=o(G,t,Z.map(e),w),i=Z.map(function(t){var n={};return t.categories.forEach(function(t){n[t.name]=t}),n}),function f(t,n){if(t.children){var e=Z[n],r=i[n];for(var a in t.children)r.hasOwnProperty(a)||e.categories.push(r[a]={name:a}),f(t.children[a],n+1)}}(G,0),V.domain([]).range(d3.range(Z[0].categories.length)),j=v(G,Z,V),W=r(Z),Z.forEach(function(t){t.count=W}),a=a.data(Z,e);var s=a.enter().append("g").attr("class","dimension").attr("transform",function(t){return"translate(0,"+t.y+")"}).on("mousedown.parsets",n);a.each(function(t){t.y0=t.y,t.categories.forEach(function(t){t.x0=t.x})}),s.append("rect").attr("width",P).attr("y",-45).attr("height",45);var d=s.append("text").attr("class","dimension").attr("transform","translate(0,-25)");d.append("tspan").attr("class","name").text(l),d.append("tspan").attr("class","sort alpha").attr("dx","2em").text("alpha >>").on("mousedown.parsets",n),d.append("tspan").attr("class","sort size").attr("dx","2em").text("size >>").on("mousedown.parsets",n),a.call(d3.behavior.drag().origin(u).on("dragstart",function(t){F=!0,t.y0=t.y}).on("drag",function(n){n.y0=n.y=d3.event.y;for(var i=1;i<Z.length;i++)if(A*Z[i].y<A*Z[i-1].y){Z.sort(C),M=Z.map(e),V.domain([]).range(d3.range(Z[0].categories.length)),j=v(G=o({children:{},count:0},t,M,w),Z,V),W=r(Z),J.selectAll(".ribbon, .ribbon-mouse").selectAll("path").remove(),b(),R(a),a.transition().duration(S).attr("transform",c).tween("ribbon",N),k.sortDimensions();break}d3.select(this).attr("transform","translate(0,"+n.y+")").transition(),_.filter(function(t){return t.source.dimension===n||t.target.dimension===n}).attr("d",y)}).on("dragend",function(t){F=!1,L();var n=45,e=(A-n-2)/(Z.length-1);Z.forEach(function(t,r){t.y=n+r*e}),g(d3.select(this)).attr("transform","translate(0,"+t.y+")").tween("ribbon",N)})),a.select("text").select("tspan.sort.alpha").on("click.parsets",p("alpha",function(t,n){return t.name<n.name?1:-1},a)),a.select("text").select("tspan.sort.size").on("click.parsets",p("size",function(t,n){return t.count-n.count},a)),a.transition().duration(S).attr("transform",function(t){return"translate(0,"+t.y+")"}).tween("ribbon",N),a.exit().remove(),R(a),b()}function p(t,n,e){return function(r){var a=this.__direction=-(this.__direction||1);d3.select(this).text(a>0?t+" >>":"<< "+t),r.categories.sort(function(){return a*n.apply(this,arguments)}),j=v(G,Z,V),R(e),b(),k.sortCategories()}}function b(){_=J.select(".ribbon").selectAll("path").data(j,function(t){return t.path}),_.enter().append("path").each(function(t){t.source.x0=t.source.x,t.target.x0=t.target.x}).attr("class",function(t){return"category-"+t.major}).attr("d",y),_.sort(function(t,n){return n.count-t.count}),_.exit().remove();var t=J.select(".ribbon-mouse").selectAll("path").data(j,function(t){return t.path});t.enter().append("path").on("mousemove.parsets",function(t){_.classed("active",!1),F||(z(t=t.node,!0),f($.call(this,t)),d3.event.stopPropagation())}),t.sort(function(t,n){return n.count-t.count}).attr("d",x),t.exit().remove()}function O(t){var n=[t],e=_.filter(function(e){var r,a;return e.source.node===t&&n.push(r=e.source),e.target.node===t&&n.push(a=e.target),r||a}),r=n.map(function(t){return d3.interpolateNumber(t.x0,t.x)}),a=n.length;return function(t){for(var o=0;a>o;o++)n[o].x0=r[o](t);e.attr("d",y)}}function N(t){var n=_.filter(function(n){return n.source.dimension.name==t.name||n.target.dimension.name==t.name}),e=d3.interpolateNumber(t.y0,t.y);return function(r){t.y0=e(r),n.attr("d",y)}}function z(t,n){if(!F){var e=[];if(function r(t){e.push(t);for(var n in t.children)r(t.children[n])}(t),e.shift(),n)for(;t;)e.push(t),t=t.parent;_.filter(function(t){var n=e.indexOf(t.node)>=0;return n&&this.parentNode.appendChild(this),n}).classed("active",!0)}}function L(){F||(_.classed("active",!1),m())}function R(t){var e=t.selectAll("g.category").data(function(t){return t.categories},function(t){return t.name}),r=e.enter().append("g").attr("class","category").attr("transform",function(t){return"translate("+t.x+")"});e.exit().remove(),e.on("mousemove.parsets",function(t){_.classed("active",!1),F||(t.nodes.forEach(function(t){z(t)}),f(D.call(this,t)),d3.event.stopPropagation())}).on("mouseout.parsets",L).on("mousedown.parsets",n).call(d3.behavior.drag().origin(u).on("dragstart",function(t){F=!0,t.x0=t.x}).on("drag",function(n){n.x=d3.event.x;for(var e=n.dimension.categories,r=0,a=e[0];++r<e.length;)if(a.x+a.dx/2>(a=e[r]).x+a.dx/2){e.sort(function(t,n){return t.x+t.dx/2-n.x-n.dx/2}),j=v(G,Z,V),b(),R(t),z(n.node),k.sortCategories();break}var o=0,i=B/(e.length-1);e.forEach(function(t){n===t&&(t.x0=d3.event.x),t.x=o,o+=t.count/W*(P-B)+i}),d3.select(this).attr("transform",function(t){return"translate("+t.x0+")"}).transition(),_.filter(function(t){return t.source.node===n||t.target.node===n}).attr("d",y)}).on("dragend",function(t){F=!1,L(),b(),g(d3.select(this)).attr("transform","translate("+t.x+")").tween("ribbon",O)})),e.transition().duration(S).attr("transform",function(t){return"translate("+t.x+")"}).tween("ribbon",O),r.append("rect").attr("width",function(t){return t.dx}).attr("y",-20).attr("height",20),r.append("line").style("stroke-width",2),r.append("text").attr("dy","-.3em"),e.select("rect").attr("width",function(t){return t.dx}).attr("class",function(t){return"category-"+(t.dimension===Z[0]?V(t.name):"background")}),e.select("line").attr("x2",function(t){return t.dx}),e.select("text").text(a(function(t){return t.name},function(t){return t.dx}))}var j,W,_,J=d3.select(this),V=d3.scale.ordinal(),F=!1,M=T.call(this,t,i),Z=[],G={children:{},count:0};if(d3.select(window).on("mousemove.parsets."+ ++h,L),null==E&&(E=H),J.selectAll(".ribbon, .ribbon-mouse").data(["ribbon","ribbon-mouse"],String).enter().append("g").attr("class",String),d(),H!=E){var q=d3.transition(J);q.tween?q.tween("ribbon",s):s()(1)}})}function l(t,n){return O.call(this,t.name,n)}function f(t){var n=d3.mouse(N.node());z.style("display",null).style("left",n[0]+30+"px").style("top",n[1]-20+"px").html(t)}function m(){z.style("display","none")}function g(t){return S?t.transition().duration(S).ease(p):t}function v(t,n,e){function r(t,e,o,i){var u=e.node,s=n[o];s.categories.forEach(function(d){var l=d.name;if(u.children.hasOwnProperty(l)){var f=u.children[l];f.path=e.path+"\x00"+l;var p=f.target||{node:d,dimension:s};p.x=d["in"].dx,p.dx=f.count/c*(P-B),d["in"].dx+=p.dx;var h=f.source||{node:t,dimension:n[o-1]};h.x=t.out.dx,h.dx=p.dx,t.out.dx+=h.dx,f.node=f,f.source=h,f.target=p,f.major=i,a.push(f),o+1<n.length&&r(d,f,o+1,i)}})}var a=[],o=n.length,i=45,u=(A-i-2)/(o-1);n.forEach(function(t,n){t.categories.forEach(function(n){n.dimension=t,n.count=0,n.nodes=[]}),t.y=i+n*u});var c=function d(t,e){if(!t.children)return t.count;var r=n[e],a=0;return r.categories.forEach(function(n){var r=t.children[n.name];if(r){n.nodes.push(r);var o=d(r,e+1);n.count+=o,a+=o}}),a}(t,0);n.forEach(function(t){t.categories=t.categories.filter(function(t){return t.count});var n=0,e=B/(t.categories.length-1);t.categories.forEach(function(t){t.x=n,t.dx=t.count/c*(P-B),t["in"]={dx:0},t.out={dx:0},n+=t.dx+e})});var s=n[0];return s.categories.forEach(function(n){var a=n.name;t.children.hasOwnProperty(a)&&r(n,{node:t.children[a],path:a},1,e(a))}),a}function y(t){var n=t.source,e=t.target;return b(n.node.x0+n.x0,n.dimension.y0,n.dx,e.node.x0+e.x0,e.dimension.y0,e.dx,E)}function x(t){var n=t.source,e=t.target;return b(n.node.x+n.x,n.dimension.y,n.dx,e.node.x+e.x,e.dimension.y,e.dx,H)}function b(t,n,e,r,a,o,i){var u,c;return(1===i?["M",[t,n],"L",[r,a],"h",o,"L",[t+e,n],"Z"]:["M",[t,n],"C",[t,u=i*n+(1-i)*a]," ",[r,c=i*a+(1-i)*n]," ",[r,a],"h",o,"C",[r+o,c]," ",[t+e,u]," ",[t+e,n],"Z"]).join("")}function C(t,n){return t=A*t.y,n=A*n.y,n>t?-1:t>n?1:t>=n?0:t>=t?-1:n>=n?1:NaN}var w,P,A,E,k=d3.dispatch("sortDimensions","sortCategories"),T=t,O=String,$=s,D=d,B=20,H=1,S=500;i.dimensionFormat=function(t){return arguments.length?(O=t,i):O},i.dimensions=function(t){return arguments.length?(T=d3.functor(t),i):T},i.value=function(t){return arguments.length?(w=d3.functor(t),i):w},i.width=function(t){return arguments.length?(P=+t,i):P},i.height=function(t){return arguments.length?(A=+t,i):A},i.spacing=function(t){return arguments.length?(B=+t,i):B},i.tension=function(t){return arguments.length?(H=+t,i):H},i.duration=function(t){return arguments.length?(S=+t,i):S},i.tooltip=function(t){return arguments.length?($=null==t?s:t,i):z},i.categoryTooltip=function(t){return arguments.length?(D=null==t?d:t,i):D};var N=d3.select("body"),z=N.append("div").style("display","none").attr("class","parsets tooltip");return d3.rebind(i,k,"on").value(1).width(960).height(600)},d3.parsets.tree=o;var l=d3.format("%"),f=d3.format(",f"),p="elastic",h=0}(),function(){"use strict";angular.module("myApp",["myApp.controllers","myApp.directives"]),angular.module("myApp.controllers",[]),angular.module("myApp.directives",[])}();var dataJSON={percentOfElectorate:{Democrat:30,Republican:26,independent:44},data:[{Party:"Democrat",Candidate:"Bernie",Count:39},{Party:"Democrat",Candidate:"Hillary",Count:49},{Party:"Democrat",Candidate:"Trump",Count:12},{Party:"Republican",Candidate:"Bernie",Count:17},{Party:"Republican",Candidate:"Hillary",Count:13},{Party:"Republican",Candidate:"Trump",Count:70},{Party:"independent",Candidate:"Bernie",Count:63},{Party:"independent",Candidate:"Hillary",Count:17},{Party:"independent",Candidate:"Trump",Count:20}],favorability:[{Party:"Democrat",Candidate:"Bernie",Count:0},{Party:"Democrat",Candidate:"Hillary",Count:0},{Party:"Democrat",Candidate:"Trump",Count:0},{Party:"Republican",Candidate:"Bernie",Count:0},{Party:"Republican",Candidate:"Hillary",Count:0},{Party:"Republican",Candidate:"Trump",Count:0},{Party:"independent",Candidate:"Bernie",Count:0},{Party:"independent",Candidate:"Hillary",Count:0},{Party:"independent",Candidate:"Trump",Count:0}]};!function(){"use strict";angular.module("myApp.controllers",["nvd3"]).controller("ParsetsCtrl",["$scope",function(t){t.election=dataJSON.data,t.electorateScope=dataJSON.percentOfElectorate,t.party=[1,2,3],t.totals=[{key:"",values:[{label:"Bernie",value:0},{label:"Hillary",value:0},{label:"Trump",value:0}]}],t.$watch("totals",function(n){t.totals=n},!0),t.options={chart:{type:"multiBarHorizontalChart",showControls:!1,showLegend:!1,barColor:["#2f107a","#07487f","#b35d06"],margin:{top:20,right:20,bottom:50,left:55},x:function(t){return t.label},y:function(t){return t.value},showValues:!1,valueFormat:function(t){return d3.format(",.2f")(t)},duration:500,xAxis:{},yAxis:{axisLabel:"Percent of Total Popular Vote",axisLabelDistance:-5},tooltip:{contentGenerator:function(t){return"<span>"+t.data.label+"</span><span>&nbsp;"+d3.format(",.2f")(t.data.value)+"%</span>"}}}}}])}(),function(){"use strict";angular.module("myApp.directives").directive("d3Parsets",["$window","$timeout",function(t,n){return{restrict:"EA",scope:{data:"=",totals:"=",electorate:"="},link:function(n,e,r){var a=t.d3,o=a.select(e[0]).append("svg").attr("width","100%");window.onresize=function(){return n.$apply()},n.$watch(function(){return angular.element(window)[0].innerWidth},function(){return n.render(n.data)});var i=function(t){var e=0,r=0,a=0;if(t)for(var o=0;o<t.length;o++){var i=t[o];"Bernie"==i.Candidate&&(e+=i.Count*n.electorate[i.Party]/100),"Hillary"==i.Candidate&&(r+=i.Count*n.electorate[i.Party]/100),"Trump"==i.Candidate&&(a+=i.Count*n.electorate[i.Party]/100)}return[{key:"Vote Percent",values:[{label:"Bernie",value:e},{label:"Hillary",value:r},{label:"Trump",value:a}]}]};n.$watch("data",function(t){return n.totals=i(t),n.render(n.data)},!0),n.render=function(r){function i(t){return"<h4>"+t.name+"<br>"+a.round(t.count,2)+"%</h4>"}function u(t){var e,r,o=t.count,i=[];for("Party"==t.dimension&&(e=t.name);t.parent;)t.name&&i.unshift(t.name),t=t.parent;return void 0==e?(e=i[0],r=" > "):r=" < ","<h4>"+i.join(r)+"<br>"+a.round(100*o/n.electorate[e],2)+"%</h4>"}function c(t){return t.Count*n.electorate[t.Party]/100}o.selectAll("*").remove();var s=a.select(e[0])[0][0].offsetWidth-20,d=.55*s;o.attr("height",d);var l=t.d3.parsets().dimensions(["Party","Candidate"]).value(c).width(s).height(d).spacing(30).tension(.75).tooltip(u).categoryTooltip(i),f=o.append("svg").attr("width",l.width()).attr("height",l.height());f.datum(r).call(l)}}}}])}(),function(){"use strict";angular.module("myApp.directives").directive("d3Slider",["$window",function(t){return{restrict:"EA",scope:{data:"=",party:"="},link:function(n,e,r){var a=t.d3,o=a.select(e[0]).append("svg").attr("width","100%");window.onresize=function(){return n.$apply()},n.$watch(function(){return angular.element(window)[0].innerWidth},function(){return n.render(n.data)}),n.$watch("data",function(t){return n.render(t)},!0),n.render=function(t){function r(){g.classed("selecting",!0)}function i(){var t=m.extent();v.select("rect.party").attr("width",t[0]*f/100),c[0].Count=t[0],c[1].Count=t[1]-t[0],c[2].Count=100-t[1],y.text(c[0].Candidate+": "+a.round(c[0].Count,2)+"%"),x.text(c[1].Candidate+": "+a.round(c[1].Count,2)+"%"),b.text(c[2].Candidate+": "+a.round(c[2].Count,2)+"%")}function u(){g.classed("selecting",!a.event.target.empty()),n.$apply()}var c;1==n.party?c=t.slice(0,3):2==n.party?c=t.slice(3,6):3==n.party&&(c=t.slice(6,9)),o.selectAll("*").remove();var s=a.select(e[0])[0][0].offsetWidth-20,d=.15*s;o.attr("height",d/1.5);var l={top:15,right:15,bottom:10,left:15},f=s-l.left-l.right,p=d-l.top-l.bottom,h=a.scale.linear().domain([0,100]).range([0,f]),m=a.svg.brush().x(h).extent([c[0].Count,100-c[2].Count]).on("brushstart",r).on("brush",i).on("brushend",u),g=o.append("svg").attr("width",f+l.left+l.right).attr("height",p+l.top+l.bottom).append("g").attr("transform","translate("+l.left+","+l.top+")"),v=g.append("g").attr("class","brush").call(m),y=g.append("text").attr("class","text-svg").attr("text-anchor","middle").attr("dy",.06*f).attr("dx",.15*f),x=g.append("text").attr("class","text-svg").attr("text-anchor","middle").attr("dy",.06*f).attr("dx",.5*f),b=g.append("text").attr("class","text-svg").attr("text-anchor","middle").attr("dy",.06*f).attr("dx",.85*f);v.insert("rect",".extent").attr("class","party").attr("x",0).attr("width",c[0].Count*f/100),v.selectAll(".resize").append("image").attr("class","icon").attr("xlink:href","./css/images/bookmark.svg").attr("y",-.0175*f).attr("x",-.043*f).attr("width",.085*f).attr("height",.055*f),v.selectAll("rect").attr("height",p/4),v.select("rect.background").style({visibility:"visible"}),r(),i()}}}}])}();